import{u as ge}from"./auth-DQHpPayR.js";import{d as be,a as r,c as E,l as we,b as n,m as z,o as M,f as l,w as t,g as u,v as k,j as s,s as H,t as v,F as Ce,n as ke,e as xe,_ as Ve}from"./index-ChimEHM8.js";import{f as J}from"./format-sbWH3_uq.js";const Oe={class:"d-flex align-center justify-space-between"},Se={class:"font-weight-medium text-primary"},De={class:"font-weight-medium"},he={class:"text-caption text-medium-emphasis"},Me={class:"font-weight-medium"},Pe=be({__name:"OrdersView",setup($e){const x=ge(),O=r(!1),S=r(!1),f=r(""),_=r(""),p=r([]),D=r(!1),X=r(10),P=r([{key:"created_at",order:"desc"}]),$=r([!0]),V=r(!1),T=r(0),F=r(0),c=r(null),y=r(!1),U=r([]),j=r([{title:"Pending",value:"pending"},{title:"Processing",value:"processing"},{title:"Shipped",value:"shipped"},{title:"Delivered",value:"delivered"},{title:"Cancelled",value:"cancelled"}]),Y=[{title:"Order #",key:"order_number",width:"120px"},{title:"Customer",key:"customer_email",width:"200px"},{title:"Status",key:"status",width:"120px"},{title:"Total",key:"total",width:"100px"},{title:"Items",key:"item_count",width:"80px"},{title:"Date",key:"created_at",width:"120px"},{title:"Actions",key:"actions",width:"80px",sortable:!1}],q=E(()=>{let o=U.value;if(f.value){const e=f.value.toLowerCase();o=o.filter(d=>d.order_number.toLowerCase().includes(e)||d.customer_email.toLowerCase().includes(e)||d.customer_name.toLowerCase().includes(e))}if(_.value&&(o=o.filter(e=>e.status===_.value)),p.value.length===2){const[e,d]=p.value;o=o.filter(m=>{const g=new Date(m.created_at).toISOString().split("T")[0];return g>=e&&g<=d})}return o}),B=E(()=>p.value.length===2?p.value.map(o=>J(new Date(o),"MMM dd, yyyy")).join(" - "):"Select dates"),K=o=>({pending:"warning",processing:"info",shipped:"primary",delivered:"success",cancelled:"error"})[o]||"grey",Q=o=>J(new Date(o),"MMM dd, yyyy"),R=(()=>{let o;return()=>{clearTimeout(o),o=setTimeout(()=>{},300)}})(),G=()=>{},W=()=>{f.value="",_.value="",p.value=[]},Z=()=>{D.value=!1},ee=o=>{P.value=o.sortBy,$.value=o.sortDesc},te=(o,e)=>{c.value=o,T.value=e.clientX,F.value=e.clientY,V.value=!0},le=async(o,e)=>{try{(await(await fetch(`/api/orders/${o.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})})).json()).success&&(o.status=e,V.value=!1)}catch(d){console.error("Failed to update order status:",d)}},ae=()=>{console.log("Create new order")},oe=o=>{window.open(`/api/orders/${o.id}/invoice`,"_blank")},ne=o=>{console.log("Send email for order:",o.id)},se=o=>{c.value=o,y.value=!0},re=async()=>{if(c.value)try{S.value=!0,(await fetch(`/api/orders/${c.value.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})})).ok&&(c.value.status="cancelled",y.value=!1,c.value=null)}catch(o){console.error("Failed to cancel order:",o)}finally{S.value=!1}},de=async()=>{try{O.value=!0;const e=await(await fetch("/api/orders")).json();e.success&&(U.value=e.data)}catch(o){console.error("Failed to load orders:",o)}finally{O.value=!1}};return we(()=>{de()}),(o,e)=>{const d=n("v-btn"),m=n("v-col"),g=n("v-row"),I=n("v-text-field"),ie=n("v-select"),ue=n("v-date-picker"),h=n("v-menu"),ce=n("v-chip"),b=n("v-icon"),w=n("v-list-item-title"),C=n("v-list-item"),me=n("v-divider"),L=n("v-list"),ve=n("v-data-table"),N=n("v-card-text"),A=n("v-card"),pe=n("v-card-title"),fe=n("v-spacer"),_e=n("v-card-actions"),ye=n("v-dialog");return M(),z("div",null,[l(g,{class:"mb-6"},{default:t(()=>[l(m,{cols:"12"},{default:t(()=>[u("div",Oe,[e[9]||(e[9]=u("div",null,[u("h1",{class:"text-h4 font-weight-bold mb-2"},"Orders"),u("p",{class:"text-body-1 text-medium-emphasis"}," Manage customer orders and track fulfillment ")],-1)),l(d,{color:"primary","prepend-icon":"mdi-plus",onClick:ae,disabled:!k(x).hasPermission("admin")},{default:t(()=>[...e[8]||(e[8]=[s(" New Order ",-1)])]),_:1},8,["disabled"])])]),_:1})]),_:1}),l(g,{class:"mb-6"},{default:t(()=>[l(m,{cols:"12",md:"4"},{default:t(()=>[l(I,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),label:"Search orders","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"",onInput:k(R)},null,8,["modelValue","onInput"])]),_:1}),l(m,{cols:"12",md:"3"},{default:t(()=>[l(ie,{modelValue:_.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>_.value=a),G],items:j.value,label:"Status",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),l(m,{cols:"12",md:"3"},{default:t(()=>[l(h,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=a=>D.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:a})=>[l(I,H({modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=i=>B.value=i),label:"Date range","prepend-inner-icon":"mdi-calendar",variant:"outlined",readonly:""},a),null,16,["modelValue"])]),default:t(()=>[l(ue,{modelValue:p.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>p.value=a),Z],range:""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"2"},{default:t(()=>[l(d,{color:"secondary",variant:"outlined",block:"",onClick:W},{default:t(()=>[...e[10]||(e[10]=[s(" Clear Filters ",-1)])]),_:1})]),_:1})]),_:1}),l(A,{class:"dashboard-card"},{default:t(()=>[l(N,null,{default:t(()=>[l(ve,{headers:Y,items:q.value,"items-per-page":X.value,loading:O.value,density:"compact",class:"transparent-table","sort-by":P.value,"sort-desc":$.value,"onUpdate:options":ee},{"item.order_number":t(({item:a})=>[u("div",Se," #"+v(a.order_number),1)]),"item.customer_email":t(({item:a})=>[u("div",null,[u("div",De,v(a.customer_name),1),u("div",he,v(a.customer_email),1)])]),"item.status":t(({item:a})=>[l(ce,{color:K(a.status),size:"small",variant:"flat",onClick:i=>te(a)},{default:t(()=>[s(v(a.status),1)]),_:2},1032,["color","onClick"])]),"item.total":t(({item:a})=>[u("span",Me,"â‚¬"+v(a.total.toFixed(2)),1)]),"item.created_at":t(({item:a})=>[s(v(Q(a.created_at)),1)]),"item.actions":t(({item:a})=>[l(h,null,{activator:t(({props:i})=>[l(d,H({icon:"",size:"small",variant:"text"},i),{default:t(()=>[l(b,null,{default:t(()=>[...e[11]||(e[11]=[s("mdi-dots-vertical",-1)])]),_:1})]),_:1},16)]),default:t(()=>[l(L,null,{default:t(()=>[l(C,{onClick:i=>o.$router.push(`/orders/${a.id}`)},{prepend:t(()=>[l(b,null,{default:t(()=>[...e[12]||(e[12]=[s("mdi-eye",-1)])]),_:1})]),default:t(()=>[l(w,null,{default:t(()=>[...e[13]||(e[13]=[s("View Details",-1)])]),_:1})]),_:1},8,["onClick"]),l(C,{onClick:i=>oe(a),disabled:!k(x).hasPermission("manager")},{prepend:t(()=>[l(b,null,{default:t(()=>[...e[14]||(e[14]=[s("mdi-printer",-1)])]),_:1})]),default:t(()=>[l(w,null,{default:t(()=>[...e[15]||(e[15]=[s("Print Invoice",-1)])]),_:1})]),_:1},8,["onClick","disabled"]),l(C,{onClick:i=>ne(a),disabled:!k(x).hasPermission("manager")},{prepend:t(()=>[l(b,null,{default:t(()=>[...e[16]||(e[16]=[s("mdi-email",-1)])]),_:1})]),default:t(()=>[l(w,null,{default:t(()=>[...e[17]||(e[17]=[s("Send Email",-1)])]),_:1})]),_:1},8,["onClick","disabled"]),l(me),l(C,{onClick:i=>se(a),disabled:!k(x).hasPermission("admin")||a.status==="cancelled",class:"error--text"},{prepend:t(()=>[l(b,{color:"error"},{default:t(()=>[...e[18]||(e[18]=[s("mdi-cancel",-1)])]),_:1})]),default:t(()=>[l(w,null,{default:t(()=>[...e[19]||(e[19]=[s("Cancel Order",-1)])]),_:1})]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),_:1},8,["items","items-per-page","loading","sort-by","sort-desc"])]),_:1})]),_:1}),l(h,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),"position-x":T.value,"position-y":F.value,absolute:"","offset-y":""},{default:t(()=>[l(L,null,{default:t(()=>[(M(!0),z(Ce,null,ke(j.value,a=>(M(),xe(C,{key:a.value,onClick:i=>le(c.value,a.value)},{default:t(()=>[l(w,null,{default:t(()=>[s(v(a.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue","position-x","position-y"]),l(ye,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=a=>y.value=a),"max-width":"400"},{default:t(()=>[l(A,null,{default:t(()=>[l(pe,{class:"text-h6"},{default:t(()=>[...e[20]||(e[20]=[s("Cancel Order",-1)])]),_:1}),l(N,null,{default:t(()=>{var a;return[s(" Are you sure you want to cancel order #"+v((a=c.value)==null?void 0:a.order_number)+"? This action cannot be undone. ",1)]}),_:1}),l(_e,null,{default:t(()=>[l(fe),l(d,{variant:"text",onClick:e[6]||(e[6]=a=>y.value=!1)},{default:t(()=>[...e[21]||(e[21]=[s("Keep Order",-1)])]),_:1}),l(d,{color:"error",variant:"text",onClick:re,loading:S.value},{default:t(()=>[...e[22]||(e[22]=[s(" Cancel Order ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),je=Ve(Pe,[["__scopeId","data-v-c5326bc5"]]);export{je as default};
