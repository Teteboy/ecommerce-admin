import{u as Ve}from"./auth-DQHpPayR.js";import{d as ke,a as i,r as Ce,c as xe,l as Ue,b as o,m as Se,o as K,f as a,w as l,g as v,v as y,j as n,t as d,s as Pe,e as De,q as $e,_ as qe}from"./index-ChimEHM8.js";import{f as Ae}from"./format-sbWH3_uq.js";const Re={class:"d-flex align-center justify-space-between"},Te={class:"d-flex align-center"},je={class:"font-weight-medium"},Be={class:"text-caption text-medium-emphasis"},Ee=ke({__name:"UsersView",setup(Ne){const w=Ve(),$=i(!1),q=i(!1),A=i(!1),U=i(""),S=i(""),P=i(""),W=i(10),B=i(["created_at"]),E=i([!0]),_=i(!1),b=i(!1),p=i(null),f=i(!1),N=i(!1),h=i([]),u=Ce({first_name:"",last_name:"",email:"",password:"",role:"manager",status:"active"}),L=i([{title:"Super Admin",value:"super_admin"},{title:"Admin",value:"admin"},{title:"Manager",value:"manager"}]),z=i([{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}]),X=[{title:"User",key:"name",width:"250px"},{title:"Role",key:"role",width:"120px"},{title:"Last Login",key:"last_login",width:"150px"},{title:"Status",key:"status",width:"100px"},{title:"Created",key:"created_at",width:"120px"},{title:"Actions",key:"actions",width:"80px",sortable:!1}],Y=xe(()=>{let t=h.value;if(U.value){const e=U.value.toLowerCase();t=t.filter(r=>r.first_name.toLowerCase().includes(e)||r.last_name.toLowerCase().includes(e)||r.email.toLowerCase().includes(e))}return S.value&&(t=t.filter(e=>e.role===S.value)),P.value&&(t=t.filter(e=>e.status===P.value)),t}),I=[t=>!!t||"This field is required",t=>t.length>=2||"Must be at least 2 characters"],Z=[t=>!!t||"Email is required",t=>/.+@.+\..+/.test(t)||"Email must be valid"],ee=[t=>!!t||"Role is required"],te=[t=>!!t||"Status is required"],ae=[t=>!!t||"Password is required",t=>t.length>=8||"Password must be at least 8 characters"],le=t=>({super_admin:"error",admin:"warning",manager:"primary"})[t]||"grey",M=t=>Ae(new Date(t),"MMM dd, yyyy"),se=(()=>{let t;return()=>{clearTimeout(t),t=setTimeout(()=>{},300)}})(),O=()=>{},oe=t=>{B.value=t.sortBy,E.value=t.sortDesc},ne=()=>{f.value=!1,Object.assign(u,{first_name:"",last_name:"",email:"",password:"",role:"manager",status:"active"}),_.value=!0},re=t=>{f.value=!0,Object.assign(u,{first_name:t.first_name,last_name:t.last_name,email:t.email,password:"",role:t.role,status:t.status}),p.value=t,_.value=!0},ie=t=>{console.log("View user:",t.id)},ue=t=>{console.log("Reset password for user:",t.id)},de=async t=>{try{const e=t.status==="active"?"inactive":"active",r=localStorage.getItem("auth_token");(await(await fetch(`/api/users/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:r?`Bearer ${r}`:""},body:JSON.stringify({status:e})})).json()).success&&(t.status=e)}catch(e){console.error("Failed to toggle user status:",e)}},me=t=>{p.value=t,b.value=!0},ce=async()=>{if(p.value)try{A.value=!0;const t=localStorage.getItem("auth_token");(await fetch(`/api/users/${p.value.id}`,{method:"DELETE",headers:{Authorization:t?`Bearer ${t}`:"","Content-Type":"application/json"}})).ok&&(b.value=!1,p.value=null,await R())}catch(t){console.error("Failed to delete user:",t)}finally{A.value=!1}},ve=async()=>{try{q.value=!0;const t=localStorage.getItem("auth_token"),e=f.value?`/api/users/${p.value.id}`:"/api/users",r=f.value?"PUT":"POST";(await(await fetch(e,{method:r,headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify(u)})).json()).success&&(_.value=!1,await R())}catch(t){console.error("Failed to save user:",t)}finally{q.value=!1}},R=async()=>{try{$.value=!0;const t=localStorage.getItem("auth_token"),r=await(await fetch("/api/users",{headers:{Authorization:t?`Bearer ${t}`:"","Content-Type":"application/json"}})).json();r.success&&(h.value=r.data)}catch(t){console.error("Failed to load users:",t)}finally{$.value=!1}};return Ue(()=>{R()}),(t,e)=>{const r=o("v-btn"),m=o("v-col"),V=o("v-row"),k=o("v-text-field"),D=o("v-select"),pe=o("v-img"),fe=o("v-avatar"),F=o("v-chip"),g=o("v-icon"),C=o("v-list-item-title"),x=o("v-list-item"),_e=o("v-divider"),ge=o("v-list"),ye=o("v-menu"),we=o("v-data-table"),T=o("v-card-text"),j=o("v-card"),J=o("v-card-title"),be=o("v-form"),H=o("v-spacer"),Q=o("v-card-actions"),G=o("v-dialog");return K(),Se("div",null,[a(V,{class:"mb-6"},{default:l(()=>[a(m,{cols:"12"},{default:l(()=>[v("div",Re,[e[15]||(e[15]=v("div",null,[v("h1",{class:"text-h4 font-weight-bold mb-2"},"Users"),v("p",{class:"text-body-1 text-medium-emphasis"}," Manage system users and their permissions ")],-1)),a(r,{color:"primary","prepend-icon":"mdi-plus",onClick:ne,disabled:!y(w).hasPermission("super_admin")},{default:l(()=>[...e[14]||(e[14]=[n(" Add User ",-1)])]),_:1},8,["disabled"])])]),_:1})]),_:1}),a(V,{class:"mb-6"},{default:l(()=>[a(m,{cols:"12",md:"6"},{default:l(()=>[a(k,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=s=>U.value=s),label:"Search users","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"",onInput:y(se)},null,8,["modelValue","onInput"])]),_:1}),a(m,{cols:"12",md:"3"},{default:l(()=>[a(D,{modelValue:S.value,"onUpdate:modelValue":[e[1]||(e[1]=s=>S.value=s),O],items:L.value,label:"Role",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),a(m,{cols:"12",md:"3"},{default:l(()=>[a(D,{modelValue:P.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>P.value=s),O],items:z.value,label:"Status",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(j,{class:"dashboard-card"},{default:l(()=>[a(T,null,{default:l(()=>[a(we,{headers:X,items:Y.value,"items-per-page":W.value,loading:$.value,density:"compact",class:"transparent-table","sort-by":B.value,"sort-desc":E.value,"must-sort":!1,"onUpdate:options":oe},{"item.name":l(({item:s})=>[v("div",Te,[a(fe,{size:"40",class:"mr-3"},{default:l(()=>[a(pe,{src:s.avatar||"/default-avatar.png",alt:s.first_name},null,8,["src","alt"])]),_:2},1024),v("div",null,[v("div",je,d(s.first_name)+" "+d(s.last_name),1),v("div",Be,d(s.email),1)])])]),"item.role":l(({item:s})=>[a(F,{color:le(s.role),size:"small",variant:"flat"},{default:l(()=>[n(d(s.role),1)]),_:2},1032,["color"])]),"item.last_login":l(({item:s})=>[v("span",null,d(s.last_login?M(s.last_login):"Never"),1)]),"item.status":l(({item:s})=>[a(F,{color:s.status==="active"?"success":"error",size:"small",variant:"flat"},{default:l(()=>[n(d(s.status),1)]),_:2},1032,["color"])]),"item.created_at":l(({item:s})=>[n(d(M(s.created_at)),1)]),"item.actions":l(({item:s})=>[a(ye,null,{activator:l(({props:c})=>[a(r,Pe({icon:"",size:"small",variant:"text"},c),{default:l(()=>[a(g,null,{default:l(()=>[...e[16]||(e[16]=[n("mdi-dots-vertical",-1)])]),_:1})]),_:1},16)]),default:l(()=>[a(ge,null,{default:l(()=>[a(x,{onClick:c=>ie(s)},{prepend:l(()=>[a(g,null,{default:l(()=>[...e[17]||(e[17]=[n("mdi-eye",-1)])]),_:1})]),default:l(()=>[a(C,null,{default:l(()=>[...e[18]||(e[18]=[n("View Details",-1)])]),_:1})]),_:1},8,["onClick"]),a(x,{onClick:c=>re(s),disabled:!y(w).hasPermission("super_admin")},{prepend:l(()=>[a(g,null,{default:l(()=>[...e[19]||(e[19]=[n("mdi-pencil",-1)])]),_:1})]),default:l(()=>[a(C,null,{default:l(()=>[...e[20]||(e[20]=[n("Edit",-1)])]),_:1})]),_:1},8,["onClick","disabled"]),a(x,{onClick:c=>ue(s)},{prepend:l(()=>[a(g,null,{default:l(()=>[...e[21]||(e[21]=[n("mdi-lock-reset",-1)])]),_:1})]),default:l(()=>[a(C,null,{default:l(()=>[...e[22]||(e[22]=[n("Reset Password",-1)])]),_:1})]),_:1},8,["onClick"]),a(_e),a(x,{onClick:c=>de(s),disabled:!y(w).hasPermission("super_admin")},{prepend:l(()=>[a(g,null,{default:l(()=>[n(d(s.status==="active"?"mdi-pause":"mdi-play"),1)]),_:2},1024)]),default:l(()=>[a(C,null,{default:l(()=>[n(d(s.status==="active"?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["onClick","disabled"]),a(x,{onClick:c=>me(s),disabled:!y(w).hasPermission("super_admin"),class:"error--text"},{prepend:l(()=>[a(g,{color:"error"},{default:l(()=>[...e[23]||(e[23]=[n("mdi-delete",-1)])]),_:1})]),default:l(()=>[a(C,null,{default:l(()=>[...e[24]||(e[24]=[n("Delete",-1)])]),_:1})]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),_:1},8,["items","items-per-page","loading","sort-by","sort-desc"])]),_:1})]),_:1}),a(G,{modelValue:_.value,"onUpdate:modelValue":e[11]||(e[11]=s=>_.value=s),"max-width":"600"},{default:l(()=>[a(j,null,{default:l(()=>[a(J,{class:"text-h6"},{default:l(()=>[n(d(f.value?"Edit User":"Create New User"),1)]),_:1}),a(T,null,{default:l(()=>[a(be,{ref:"form",modelValue:N.value,"onUpdate:modelValue":e[9]||(e[9]=s=>N.value=s)},{default:l(()=>[a(V,null,{default:l(()=>[a(m,{cols:"12",md:"6"},{default:l(()=>[a(k,{modelValue:u.first_name,"onUpdate:modelValue":e[3]||(e[3]=s=>u.first_name=s),label:"First Name",variant:"outlined",rules:I,required:""},null,8,["modelValue"])]),_:1}),a(m,{cols:"12",md:"6"},{default:l(()=>[a(k,{modelValue:u.last_name,"onUpdate:modelValue":e[4]||(e[4]=s=>u.last_name=s),label:"Last Name",variant:"outlined",rules:I,required:""},null,8,["modelValue"])]),_:1}),a(m,{cols:"12"},{default:l(()=>[a(k,{modelValue:u.email,"onUpdate:modelValue":e[5]||(e[5]=s=>u.email=s),label:"Email",type:"email",variant:"outlined",rules:Z,required:"",disabled:f.value},null,8,["modelValue","disabled"])]),_:1}),a(m,{cols:"12",md:"6"},{default:l(()=>[a(D,{modelValue:u.role,"onUpdate:modelValue":e[6]||(e[6]=s=>u.role=s),items:L.value,label:"Role",variant:"outlined",rules:ee,required:"",disabled:!y(w).hasPermission("super_admin")},null,8,["modelValue","items","disabled"])]),_:1}),a(m,{cols:"12",md:"6"},{default:l(()=>[a(D,{modelValue:u.status,"onUpdate:modelValue":e[7]||(e[7]=s=>u.status=s),items:z.value,label:"Status",variant:"outlined",rules:te,required:""},null,8,["modelValue","items"])]),_:1}),f.value?$e("",!0):(K(),De(m,{key:0,cols:"12"},{default:l(()=>[a(k,{modelValue:u.password,"onUpdate:modelValue":e[8]||(e[8]=s=>u.password=s),label:"Password",type:"password",variant:"outlined",rules:ae,required:""},null,8,["modelValue"])]),_:1}))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(Q,null,{default:l(()=>[a(H),a(r,{variant:"text",onClick:e[10]||(e[10]=s=>_.value=!1)},{default:l(()=>[...e[25]||(e[25]=[n("Cancel",-1)])]),_:1}),a(r,{color:"primary",variant:"text",onClick:ve,loading:q.value},{default:l(()=>[n(d(f.value?"Update":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(G,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=s=>b.value=s),"max-width":"400"},{default:l(()=>[a(j,null,{default:l(()=>[a(J,{class:"text-h6"},{default:l(()=>[...e[26]||(e[26]=[n("Delete User",-1)])]),_:1}),a(T,null,{default:l(()=>{var s,c;return[n(" Are you sure you want to delete "+d((s=p.value)==null?void 0:s.first_name)+" "+d((c=p.value)==null?void 0:c.last_name)+"? This action cannot be undone. ",1)]}),_:1}),a(Q,null,{default:l(()=>[a(H),a(r,{variant:"text",onClick:e[12]||(e[12]=s=>b.value=!1)},{default:l(()=>[...e[27]||(e[27]=[n("Cancel",-1)])]),_:1}),a(r,{color:"error",variant:"text",onClick:ce,loading:A.value},{default:l(()=>[...e[28]||(e[28]=[n(" Delete ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ie=qe(Ee,[["__scopeId","data-v-5b9e0ddc"]]);export{Ie as default};
