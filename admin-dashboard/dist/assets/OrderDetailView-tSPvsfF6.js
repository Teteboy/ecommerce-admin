import{d as ht,x as xt,a as g,l as yt,b as i,m as Y,o as P,f as s,w as a,g as e,j as r,t as n,v as Z,F as wt,n as St,e as tt,q as kt,_ as Ct}from"./index-ChimEHM8.js";import{u as Ot}from"./auth-DQHpPayR.js";import{f as Vt}from"./format-sbWH3_uq.js";const Pt={class:"d-flex align-center justify-space-between"},jt={class:"d-flex align-center"},Ft={class:"text-h4 font-weight-bold mb-2"},Tt={class:"text-body-1 text-medium-emphasis"},Dt={class:"d-flex gap-2"},It={class:"d-flex align-center justify-space-between"},Nt={class:"font-weight-medium"},Ut={class:"text-caption text-medium-emphasis"},zt={class:"d-flex align-center"},$t={class:"font-weight-medium"},Bt={class:"text-caption text-medium-emphasis"},qt={class:"font-weight-medium"},At={class:"font-weight-medium"},Ht={class:"font-weight-medium"},Mt={class:"mb-4"},Et={class:"font-weight-medium mb-1"},Jt={class:"text-body-2 text-medium-emphasis"},Lt={class:"text-body-2 text-medium-emphasis"},Qt={class:"mb-4"},Rt={class:"text-body-2"},Gt={class:"text-body-2"},Kt={class:"d-flex justify-space-between mb-2"},Wt={class:"d-flex justify-space-between mb-2"},Xt={class:"d-flex justify-space-between mb-2"},Yt={class:"d-flex justify-space-between text-h6 font-weight-bold"},Zt={class:"mb-4"},te={class:"d-flex align-center mb-2"},ee={class:"font-weight-medium capitalize"},se={class:"text-body-2 text-medium-emphasis"},ae={class:"text-body-2 text-medium-emphasis"},le=ht({__name:"OrderDetailView",setup(oe){const et=xt(),D=Ot(),l=g(null),V=g(""),x=g(!1),y=g(""),j=g(!1),st=g([{title:"Pending",value:"pending"},{title:"Processing",value:"processing"},{title:"Shipped",value:"shipped"},{title:"Delivered",value:"delivered"},{title:"Cancelled",value:"cancelled"}]),I=g([{status:"Pending",completed:!1,timestamp:null},{status:"Processing",completed:!1,timestamp:null},{status:"Shipped",completed:!1,timestamp:null},{status:"Delivered",completed:!1,timestamp:null}]),at=[{title:"Product",key:"product",width:"300px"},{title:"Quantity",key:"quantity",width:"100px"},{title:"Price",key:"price",width:"100px"},{title:"Total",key:"total",width:"100px"}],N=u=>({pending:"warning",processing:"info",shipped:"primary",delivered:"success",cancelled:"error"})[u]||"grey",U=u=>Vt(new Date(u),"MMM dd, yyyy HH:mm"),lt=async()=>{try{const t=await(await fetch(`/api/orders/${et.params.id}`)).json();t.success&&(l.value=t.data,V.value=t.data.notes||"",z(t.data.status_history||[]))}catch(u){console.error("Failed to load order:",u)}},z=u=>{const h=["pending","processing","shipped","delivered"].indexOf(l.value.status);I.value.forEach((c,w)=>{c.completed=w<=h;const S=u.find(F=>F.status===c.status.toLowerCase());c.timestamp=S?S.timestamp:null})},ot=()=>{y.value=l.value.status,x.value=!0},nt=async()=>{try{j.value=!0,(await fetch(`/api/orders/${l.value.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:y.value})})).ok&&(l.value.status=y.value,z([]),x.value=!1)}catch(u){console.error("Failed to update order status:",u)}finally{j.value=!1}},dt=async()=>{try{await fetch(`/api/orders/${l.value.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:V.value})})}catch(u){console.error("Failed to save notes:",u)}},it=()=>{window.open(`/api/orders/${l.value.id}/invoice`,"_blank")};return yt(()=>{lt()}),(u,t)=>{const h=i("v-icon"),c=i("v-btn"),w=i("v-col"),S=i("v-row"),F=i("v-chip"),_=i("v-card-title"),rt=i("v-timeline-item"),ut=i("v-timeline"),f=i("v-card-text"),b=i("v-card"),ct=i("v-img"),mt=i("v-avatar"),pt=i("v-data-table"),vt=i("v-textarea"),T=i("v-divider"),_t=i("v-select"),ft=i("v-spacer"),bt=i("v-card-actions"),gt=i("v-dialog");return P(),Y("div",null,[s(S,{class:"mb-6"},{default:a(()=>[s(w,{cols:"12"},{default:a(()=>{var o,d;return[e("div",Pt,[e("div",jt,[s(c,{icon:"",variant:"text",onClick:t[0]||(t[0]=m=>u.$router.go(-1)),class:"mr-4"},{default:a(()=>[s(h,null,{default:a(()=>[...t[5]||(t[5]=[r("mdi-arrow-left",-1)])]),_:1})]),_:1}),e("div",null,[e("h1",Ft," Order #"+n((o=l.value)==null?void 0:o.order_number),1),e("p",Tt," Placed on "+n(U((d=l.value)==null?void 0:d.created_at)),1)])]),e("div",Dt,[s(c,{variant:"outlined",onClick:it},{default:a(()=>[s(h,{left:""},{default:a(()=>[...t[6]||(t[6]=[r("mdi-printer",-1)])]),_:1}),t[7]||(t[7]=r(" Print ",-1))]),_:1}),s(c,{color:"primary",onClick:ot,disabled:!Z(D).hasPermission("manager")},{default:a(()=>[...t[8]||(t[8]=[r(" Update Status ",-1)])]),_:1},8,["disabled"])])])]}),_:1})]),_:1}),s(S,null,{default:a(()=>[s(w,{cols:"12",lg:"8"},{default:a(()=>[s(b,{class:"dashboard-card pa-6 mb-6"},{default:a(()=>[s(_,{class:"d-flex align-center justify-space-between"},{default:a(()=>{var o;return[t[9]||(t[9]=e("h2",{class:"text-h6 font-weight-bold"},"Order Status",-1)),s(F,{color:N((o=l.value)==null?void 0:o.status),size:"large",variant:"flat"},{default:a(()=>{var d;return[r(n((d=l.value)==null?void 0:d.status),1)]}),_:1},8,["color"])]}),_:1}),s(f,null,{default:a(()=>[s(ut,{density:"compact"},{default:a(()=>[(P(!0),Y(wt,null,St(I.value,o=>(P(),tt(rt,{key:o.status,"dot-color":N(o.status),size:"small"},{default:a(()=>[e("div",It,[e("div",null,[e("div",Nt,n(o.status),1),e("div",Ut,n(o.timestamp?U(o.timestamp):"Pending"),1)]),o.completed?(P(),tt(h,{key:0,color:"success",size:"16"},{default:a(()=>[...t[10]||(t[10]=[r(" mdi-check-circle ",-1)])]),_:1})):kt("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})]),_:1})]),_:1}),s(b,{class:"dashboard-card pa-6 mb-6"},{default:a(()=>[s(_,null,{default:a(()=>[...t[11]||(t[11]=[e("h2",{class:"text-h6 font-weight-bold"},"Order Items",-1)])]),_:1}),s(f,null,{default:a(()=>{var o;return[s(pt,{headers:at,items:((o=l.value)==null?void 0:o.items)||[],density:"compact",class:"transparent-table","hide-default-footer":""},{"item.product":a(({item:d})=>[e("div",zt,[s(mt,{size:"40",class:"mr-3"},{default:a(()=>[s(ct,{src:d.product_image||"/placeholder-product.png",alt:d.product_name},null,8,["src","alt"])]),_:2},1024),e("div",null,[e("div",$t,n(d.product_name),1),e("div",Bt,n(d.sku),1)])])]),"item.quantity":a(({item:d})=>[e("span",qt,n(d.quantity),1)]),"item.price":a(({item:d})=>[e("span",At,"€"+n(d.price.toFixed(2)),1)]),"item.total":a(({item:d})=>[e("span",Ht,"€"+n((d.quantity*d.price).toFixed(2)),1)]),_:1},8,["items"])]}),_:1})]),_:1}),s(b,{class:"dashboard-card pa-6"},{default:a(()=>[s(_,null,{default:a(()=>[...t[12]||(t[12]=[e("h2",{class:"text-h6 font-weight-bold"},"Order Notes",-1)])]),_:1}),s(f,null,{default:a(()=>[s(vt,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=o=>V.value=o),label:"Internal notes",variant:"outlined",rows:"3",disabled:!Z(D).hasPermission("manager"),onBlur:dt},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),s(w,{cols:"12",lg:"4"},{default:a(()=>[s(b,{class:"dashboard-card pa-6 mb-6"},{default:a(()=>[s(_,null,{default:a(()=>[...t[13]||(t[13]=[e("h2",{class:"text-h6 font-weight-bold"},"Customer Information",-1)])]),_:1}),s(f,null,{default:a(()=>{var o,d,m,p,v,k,C,O,$,B,q,A,H,M,E,J,L,Q,R,G,K,W,X;return[e("div",Mt,[e("div",Et,n((o=l.value)==null?void 0:o.customer_name),1),e("div",Jt,n((d=l.value)==null?void 0:d.customer_email),1),e("div",Lt,n((m=l.value)==null?void 0:m.customer_phone),1)]),s(T,{class:"my-4"}),e("div",Qt,[t[16]||(t[16]=e("h3",{class:"text-subtitle-2 font-weight-bold mb-2"},"Shipping Address",-1)),e("div",Rt,[r(n((v=(p=l.value)==null?void 0:p.shipping_address)==null?void 0:v.street),1),t[14]||(t[14]=e("br",null,null,-1)),r(" "+n((C=(k=l.value)==null?void 0:k.shipping_address)==null?void 0:C.city)+", "+n(($=(O=l.value)==null?void 0:O.shipping_address)==null?void 0:$.state)+" "+n((q=(B=l.value)==null?void 0:B.shipping_address)==null?void 0:q.zip_code),1),t[15]||(t[15]=e("br",null,null,-1)),r(" "+n((H=(A=l.value)==null?void 0:A.shipping_address)==null?void 0:H.country),1)])]),s(T,{class:"my-4"}),e("div",null,[t[19]||(t[19]=e("h3",{class:"text-subtitle-2 font-weight-bold mb-2"},"Billing Address",-1)),e("div",Gt,[r(n((E=(M=l.value)==null?void 0:M.billing_address)==null?void 0:E.street),1),t[17]||(t[17]=e("br",null,null,-1)),r(" "+n((L=(J=l.value)==null?void 0:J.billing_address)==null?void 0:L.city)+", "+n((R=(Q=l.value)==null?void 0:Q.billing_address)==null?void 0:R.state)+" "+n((K=(G=l.value)==null?void 0:G.billing_address)==null?void 0:K.zip_code),1),t[18]||(t[18]=e("br",null,null,-1)),r(" "+n((X=(W=l.value)==null?void 0:W.billing_address)==null?void 0:X.country),1)])])]}),_:1})]),_:1}),s(b,{class:"dashboard-card pa-6 mb-6"},{default:a(()=>[s(_,null,{default:a(()=>[...t[20]||(t[20]=[e("h2",{class:"text-h6 font-weight-bold"},"Order Summary",-1)])]),_:1}),s(f,null,{default:a(()=>{var o,d,m,p,v,k,C,O;return[e("div",Kt,[t[21]||(t[21]=e("span",null,"Subtotal:",-1)),e("span",null,"€"+n((d=(o=l.value)==null?void 0:o.subtotal)==null?void 0:d.toFixed(2)),1)]),e("div",Wt,[t[22]||(t[22]=e("span",null,"Shipping:",-1)),e("span",null,"€"+n((p=(m=l.value)==null?void 0:m.shipping_cost)==null?void 0:p.toFixed(2)),1)]),e("div",Xt,[t[23]||(t[23]=e("span",null,"Tax:",-1)),e("span",null,"€"+n((k=(v=l.value)==null?void 0:v.tax)==null?void 0:k.toFixed(2)),1)]),s(T,{class:"my-3"}),e("div",Yt,[t[24]||(t[24]=e("span",null,"Total:",-1)),e("span",null,"€"+n((O=(C=l.value)==null?void 0:C.total)==null?void 0:O.toFixed(2)),1)])]}),_:1})]),_:1}),s(b,{class:"dashboard-card pa-6"},{default:a(()=>[s(_,null,{default:a(()=>[...t[25]||(t[25]=[e("h2",{class:"text-h6 font-weight-bold"},"Payment Information",-1)])]),_:1}),s(f,null,{default:a(()=>{var o,d,m,p;return[e("div",Zt,[e("div",te,[s(h,{class:"mr-2",color:((o=l.value)==null?void 0:o.payment_status)==="paid"?"success":"warning"},{default:a(()=>{var v;return[r(n(((v=l.value)==null?void 0:v.payment_status)==="paid"?"mdi-check-circle":"mdi-clock-outline"),1)]}),_:1},8,["color"]),e("span",ee,n((d=l.value)==null?void 0:d.payment_status),1)]),e("div",se," Method: "+n((m=l.value)==null?void 0:m.payment_method),1),e("div",ae," Transaction ID: "+n((p=l.value)==null?void 0:p.transaction_id),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),s(gt,{modelValue:x.value,"onUpdate:modelValue":t[4]||(t[4]=o=>x.value=o),"max-width":"500"},{default:a(()=>[s(b,null,{default:a(()=>[s(_,{class:"text-h6"},{default:a(()=>[...t[26]||(t[26]=[r("Update Order Status",-1)])]),_:1}),s(f,null,{default:a(()=>[s(_t,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=o=>y.value=o),items:st.value,label:"New Status",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),s(bt,null,{default:a(()=>[s(ft),s(c,{variant:"text",onClick:t[3]||(t[3]=o=>x.value=!1)},{default:a(()=>[...t[27]||(t[27]=[r("Cancel",-1)])]),_:1}),s(c,{color:"primary",variant:"text",onClick:nt,loading:j.value},{default:a(()=>[...t[28]||(t[28]=[r(" Update Status ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),re=Ct(le,[["__scopeId","data-v-bf11b536"]]);export{re as default};
