import{u as dt}from"./auth-DQHpPayR.js";import{d as rt,a as u,r as ut,c as ct,l as mt,b as i,m as vt,o as _t,f as s,w as e,g as l,v as k,j as n,t as d,s as pt,_ as ft}from"./index-ChimEHM8.js";import{f as gt}from"./format-sbWH3_uq.js";const wt={class:"d-flex align-center justify-space-between"},xt={class:"d-flex align-center"},yt={class:"mr-4"},bt={class:"text-h4 font-weight-bold white--text mb-1"},ht={class:"d-flex align-center"},Ct={class:"mr-4"},kt={class:"text-h4 font-weight-bold white--text mb-1"},St={class:"d-flex align-center"},Vt={class:"mr-4"},Dt={class:"text-h4 font-weight-bold white--text mb-1"},Tt={class:"d-flex align-center"},$t={class:"mr-4"},At={class:"text-h4 font-weight-bold white--text mb-1"},zt={class:"d-flex align-center"},It={class:"font-weight-medium"},Pt={class:"text-caption text-medium-emphasis"},jt={class:"font-weight-medium"},Bt={class:"font-weight-medium"},Et=rt({__name:"CustomersView",setup(Mt){const S=dt(),V=u(!1),D=u(!1),y=u(""),b=u(""),h=u(""),E=u(10),T=u([{key:"created_at",order:"desc"}]),$=u([!0]),f=u(!1),_=u(null),A=u([]),g=ut({total:0,newThisMonth:0,active:0,averageValue:0}),M=u(["VIP","Regular","New","Inactive"]),N=u([{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}]),L=[{title:"Customer",key:"name",width:"250px"},{title:"Segment",key:"segment",width:"120px"},{title:"Orders",key:"total_orders",width:"100px"},{title:"Total Spent",key:"total_spent",width:"120px"},{title:"Last Order",key:"last_order",width:"120px"},{title:"Status",key:"status",width:"100px"},{title:"Joined",key:"created_at",width:"120px"},{title:"Actions",key:"actions",width:"80px",sortable:!1}],O=ct(()=>{let a=A.value;if(y.value){const t=y.value.toLowerCase();a=a.filter(r=>r.first_name.toLowerCase().includes(t)||r.last_name.toLowerCase().includes(t)||r.email.toLowerCase().includes(t))}return b.value&&(a=a.filter(t=>t.segment===b.value)),h.value&&(a=a.filter(t=>t.status===h.value)),a}),F=a=>({VIP:"warning",Regular:"primary",New:"success",Inactive:"grey"})[a]||"grey",U=a=>gt(new Date(a),"MMM dd, yyyy"),J=(()=>{let a;return()=>{clearTimeout(a),a=setTimeout(()=>{},300)}})(),z=()=>{},R=a=>{T.value=a.sortBy,$.value=a.sortDesc},q=()=>{console.log("Create new customer")},H=a=>{console.log("Edit customer:",a.id)},Q=a=>{console.log("Send email to customer:",a.id)},G=async a=>{try{const t=a.status==="active"?"inactive":"active",r=localStorage.getItem("auth_token");(await(await fetch(`/api/customers/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:r?`Bearer ${r}`:""},body:JSON.stringify({status:t})})).json()).success&&(a.status=t)}catch(t){console.error("Failed to toggle customer status:",t)}},K=a=>{_.value=a,f.value=!0},W=async()=>{if(_.value)try{D.value=!0;const a=localStorage.getItem("auth_token");(await fetch(`/api/customers/${_.value.id}`,{method:"DELETE",headers:{Authorization:a?`Bearer ${a}`:"","Content-Type":"application/json"}})).ok&&(f.value=!1,_.value=null,await I())}catch(a){console.error("Failed to delete customer:",a)}finally{D.value=!1}},I=async()=>{try{V.value=!0;const a=localStorage.getItem("auth_token"),r=await(await fetch("/api/customers",{headers:{Authorization:a?`Bearer ${a}`:"","Content-Type":"application/json"}})).json();r.success&&(A.value=r.data.customers,Object.assign(g,r.data.stats))}catch(a){console.error("Failed to load customers:",a)}finally{V.value=!1}};return mt(()=>{I()}),(a,t)=>{const r=i("v-btn"),m=i("v-col"),C=i("v-row"),X=i("v-text-field"),P=i("v-select"),c=i("v-icon"),p=i("v-card"),Y=i("v-img"),Z=i("v-avatar"),j=i("v-chip"),w=i("v-list-item-title"),x=i("v-list-item"),tt=i("v-divider"),et=i("v-list"),st=i("v-menu"),at=i("v-data-table"),B=i("v-card-text"),ot=i("v-card-title"),lt=i("v-spacer"),nt=i("v-card-actions"),it=i("v-dialog");return _t(),vt("div",null,[s(C,{class:"mb-6"},{default:e(()=>[s(m,{cols:"12"},{default:e(()=>[l("div",wt,[t[6]||(t[6]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold mb-2"},"Customers"),l("p",{class:"text-body-1 text-medium-emphasis"}," Manage your customer database and relationships ")],-1)),s(r,{color:"primary","prepend-icon":"mdi-plus",onClick:q,disabled:!k(S).hasPermission("admin")},{default:e(()=>[...t[5]||(t[5]=[n(" Add Customer ",-1)])]),_:1},8,["disabled"])])]),_:1})]),_:1}),s(C,{class:"mb-6"},{default:e(()=>[s(m,{cols:"12",md:"6"},{default:e(()=>[s(X,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),label:"Search customers","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"",onInput:k(J)},null,8,["modelValue","onInput"])]),_:1}),s(m,{cols:"12",md:"3"},{default:e(()=>[s(P,{modelValue:b.value,"onUpdate:modelValue":[t[1]||(t[1]=o=>b.value=o),z],items:M.value,label:"Customer Segment",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),s(m,{cols:"12",md:"3"},{default:e(()=>[s(P,{modelValue:h.value,"onUpdate:modelValue":[t[2]||(t[2]=o=>h.value=o),z],items:N.value,label:"Status",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),s(C,{class:"mb-6"},{default:e(()=>[s(m,{cols:"12",sm:"6",md:"3"},{default:e(()=>[s(p,{class:"dashboard-card stats-gradient-primary pa-6"},{default:e(()=>[l("div",xt,[l("div",yt,[s(c,{size:"48",color:"white"},{default:e(()=>[...t[7]||(t[7]=[n("mdi-account-group",-1)])]),_:1})]),l("div",null,[l("div",bt,d(g.total),1),t[8]||(t[8]=l("div",{class:"text-caption white--text opacity-8"},"Total Customers",-1))])])]),_:1})]),_:1}),s(m,{cols:"12",sm:"6",md:"3"},{default:e(()=>[s(p,{class:"dashboard-card stats-gradient-success pa-6"},{default:e(()=>[l("div",ht,[l("div",Ct,[s(c,{size:"48",color:"white"},{default:e(()=>[...t[9]||(t[9]=[n("mdi-account-plus",-1)])]),_:1})]),l("div",null,[l("div",kt,d(g.newThisMonth),1),t[10]||(t[10]=l("div",{class:"text-caption white--text opacity-8"},"New This Month",-1))])])]),_:1})]),_:1}),s(m,{cols:"12",sm:"6",md:"3"},{default:e(()=>[s(p,{class:"dashboard-card stats-gradient-warning pa-6"},{default:e(()=>[l("div",St,[l("div",Vt,[s(c,{size:"48",color:"white"},{default:e(()=>[...t[11]||(t[11]=[n("mdi-star",-1)])]),_:1})]),l("div",null,[l("div",Dt,d(g.active),1),t[12]||(t[12]=l("div",{class:"text-caption white--text opacity-8"},"Active Customers",-1))])])]),_:1})]),_:1}),s(m,{cols:"12",sm:"6",md:"3"},{default:e(()=>[s(p,{class:"dashboard-card stats-gradient-info pa-6"},{default:e(()=>[l("div",Tt,[l("div",$t,[s(c,{size:"48",color:"white"},{default:e(()=>[...t[13]||(t[13]=[n("mdi-trending-up",-1)])]),_:1})]),l("div",null,[l("div",At," €"+d(g.averageValue.toFixed(0)),1),t[14]||(t[14]=l("div",{class:"text-caption white--text opacity-8"},"Avg. Order Value",-1))])])]),_:1})]),_:1})]),_:1}),s(p,{class:"dashboard-card"},{default:e(()=>[s(B,null,{default:e(()=>[s(at,{headers:L,items:O.value,"items-per-page":E.value,loading:V.value,density:"compact",class:"transparent-table","sort-by":T.value,"sort-desc":$.value,"onUpdate:options":R},{"item.name":e(({item:o})=>[l("div",zt,[s(Z,{size:"40",class:"mr-3"},{default:e(()=>[s(Y,{src:o.avatar||"/default-avatar.png",alt:o.first_name},null,8,["src","alt"])]),_:2},1024),l("div",null,[l("div",It,d(o.first_name)+" "+d(o.last_name),1),l("div",Pt,d(o.email),1)])])]),"item.segment":e(({item:o})=>[s(j,{color:F(o.segment),size:"small",variant:"flat"},{default:e(()=>[n(d(o.segment),1)]),_:2},1032,["color"])]),"item.total_orders":e(({item:o})=>[l("span",jt,d(o.total_orders),1)]),"item.total_spent":e(({item:o})=>[l("span",Bt,"€"+d(o.total_spent.toFixed(2)),1)]),"item.last_order":e(({item:o})=>[l("span",null,d(o.last_order?U(o.last_order):"Never"),1)]),"item.status":e(({item:o})=>[s(j,{color:o.status==="active"?"success":"error",size:"small",variant:"flat"},{default:e(()=>[n(d(o.status),1)]),_:2},1032,["color"])]),"item.actions":e(({item:o})=>[s(st,null,{activator:e(({props:v})=>[s(r,pt({icon:"",size:"small",variant:"text"},v),{default:e(()=>[s(c,null,{default:e(()=>[...t[15]||(t[15]=[n("mdi-dots-vertical",-1)])]),_:1})]),_:1},16)]),default:e(()=>[s(et,null,{default:e(()=>[s(x,{onClick:v=>a.$router.push(`/customers/${o.id}`)},{prepend:e(()=>[s(c,null,{default:e(()=>[...t[16]||(t[16]=[n("mdi-eye",-1)])]),_:1})]),default:e(()=>[s(w,null,{default:e(()=>[...t[17]||(t[17]=[n("View Details",-1)])]),_:1})]),_:1},8,["onClick"]),s(x,{onClick:v=>H(o)},{prepend:e(()=>[s(c,null,{default:e(()=>[...t[18]||(t[18]=[n("mdi-pencil",-1)])]),_:1})]),default:e(()=>[s(w,null,{default:e(()=>[...t[19]||(t[19]=[n("Edit",-1)])]),_:1})]),_:1},8,["onClick"]),s(x,{onClick:v=>Q(o)},{prepend:e(()=>[s(c,null,{default:e(()=>[...t[20]||(t[20]=[n("mdi-email",-1)])]),_:1})]),default:e(()=>[s(w,null,{default:e(()=>[...t[21]||(t[21]=[n("Send Email",-1)])]),_:1})]),_:1},8,["onClick"]),s(tt),s(x,{onClick:v=>G(o),disabled:!k(S).hasPermission("admin")},{prepend:e(()=>[s(c,null,{default:e(()=>[n(d(o.status==="active"?"mdi-pause":"mdi-play"),1)]),_:2},1024)]),default:e(()=>[s(w,null,{default:e(()=>[n(d(o.status==="active"?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["onClick","disabled"]),s(x,{onClick:v=>K(o),disabled:!k(S).hasPermission("admin"),class:"error--text"},{prepend:e(()=>[s(c,{color:"error"},{default:e(()=>[...t[22]||(t[22]=[n("mdi-delete",-1)])]),_:1})]),default:e(()=>[s(w,null,{default:e(()=>[...t[23]||(t[23]=[n("Delete",-1)])]),_:1})]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),_:1},8,["items","items-per-page","loading","sort-by","sort-desc"])]),_:1})]),_:1}),s(it,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=o=>f.value=o),"max-width":"400"},{default:e(()=>[s(p,null,{default:e(()=>[s(ot,{class:"text-h6"},{default:e(()=>[...t[24]||(t[24]=[n("Delete Customer",-1)])]),_:1}),s(B,null,{default:e(()=>{var o,v;return[n(" Are you sure you want to delete "+d((o=_.value)==null?void 0:o.first_name)+" "+d((v=_.value)==null?void 0:v.last_name)+"? This action cannot be undone. ",1)]}),_:1}),s(nt,null,{default:e(()=>[s(lt),s(r,{variant:"text",onClick:t[3]||(t[3]=o=>f.value=!1)},{default:e(()=>[...t[25]||(t[25]=[n("Cancel",-1)])]),_:1}),s(r,{color:"error",variant:"text",onClick:W,loading:D.value},{default:e(()=>[...t[26]||(t[26]=[n(" Delete ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ft=ft(Et,[["__scopeId","data-v-801be47f"]]);export{Ft as default};
